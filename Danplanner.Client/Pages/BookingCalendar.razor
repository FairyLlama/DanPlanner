@page "/bookingcalendar"
@rendermode InteractiveServer
@using BlazorCalendar
@using BlazorCalendar.Models
@using System.Runtime.CompilerServices
@using Danplanner.Shared.Models
@inject IBookingService BookingService

<link href="_content/BlazorCalendar/BlazorCalendar.css" rel="stylesheet" />

<label>
    Start dato<br/>
    <InputDate @bind-Value="@startDate" />
</label>
<label>
    Slut dato<br/>
    <InputDate @bind-Value="@endDate" />
</label>


<button @onclick="CreateBooking">Book tid</button>

<CalendarContainer DisplayedView="DisplayedView.Monthly" TasksList="Bookings?.ToArray()">
    <MonthlyView HighlightToday="true" />
</CalendarContainer>

@code{
    private List<Tasks>? Bookings = new();
    private DateTime? startDate;
    private DateTime? endDate;

    private async Task CreateBooking()
    {
        Bookings?.Add(
            new Tasks { ID = Bookings.Count+1, DateStart = startDate!.Value, DateEnd = endDate!.Value, Color = "#FFD800", Caption = "Reserveret" }
        );
        // opret booking i databasen
        // await BookingService.CreateAsync(new BookingDto{});
    }

    private void OnClick()
    {
        base.StateHasChanged();
        Console.WriteLine("HANDLED");
    }

    protected async override Task OnInitializedAsync()
    {
        var retrieved = await BookingService.GetAllAsync();

        Bookings?.AddRange([new Tasks { ID = 1, DateStart = DateTime.Now.AddDays(8), DateEnd = DateTime.Now.AddDays(8), Code = "CP", Color = "#19C319", Caption = "Lorem ipsum dolor sit amet" },
			new Tasks { ID = 2, DateStart = DateTime.Now.AddDays(50), DateEnd = DateTime.Now.AddDays(52), Code = "DEV", Color = "#FFD800", Caption = "Fusce quis purus eu ante" },
			new Tasks { ID = 3, DateStart = DateTime.Now.AddDays(62), DateEnd = DateTime.Now.AddDays(62), Code = "DEV", Color = "#FFD800" },
			new Tasks { ID = 4, DateStart = DateTime.Now.AddDays(62), DateEnd = DateTime.Now.AddDays(62), Code = "FORM", Color = "#FFC3FF", Caption = "Ut sit amet turpis eget" } ,
			new Tasks { ID = 5, DateStart = DateTime.Now.AddDays(73).AddHours(8), DateEnd = DateTime.Now.AddDays(73).AddHours(9), Code = "MEETING", Color = "#2DD7D7" }]);

        retrieved.ForEach(booking =>
            Bookings?.Add(
            new Tasks { ID = booking.Id, DateStart = booking.StartDate, DateEnd = booking.EndDate, Code="Reserved", Color = "#aaa" }));

        @* await base.OnInitializedAsync(); *@
    }
}